<div class="top-links">
    <a href="/login" id="login-link">로그인</a>
    <a href="/join" id="join-link">회원가입</a>
    <a href="javascript:void(0)" id="logout-link" onclick="logout();">로그아웃</a>
    <a href="/mypage" id="mypage">마이페이지</a>
    <a href="/cart" id="cart">장바구니</a>
    <a href="/admin" id="admin-link" style="display:none;">관리자</a>  <!-- 관리자 링크 추가 -->
</div>
<script src="/js/request.js"></script>
<script src="/js/auth.js"></script>
<script>
    function parseJwt(token) {
        try {
            return JSON.parse(atob(token.split('.')[1]));
        } catch (e) {
            return null;
        }
    }

    const token = localStorage.getItem('access_token');
    const loginLink = document.getElementById('login-link');
    const joinLink = document.getElementById('join-link');
    const logoutLink = document.getElementById('logout-link');
    const mypageLink = document.getElementById('mypage');
    const cartLink = document.getElementById('cart');
    const adminLink = document.getElementById('admin-link');

    function showGuestUI() {
        loginLink.style.display = 'inline';
        joinLink.style.display = 'inline';
        logoutLink.style.display = 'none';
        mypageLink.style.display = 'none';
        cartLink.style.display = 'none';
        adminLink.style.display = 'none';
    }

    function showUserUI(payload) {
        loginLink.style.display = 'none';
        joinLink.style.display = 'none';
        logoutLink.style.display = 'inline';
        mypageLink.style.display = 'inline';
        cartLink.style.display = 'inline';

        if (payload.userRole && payload.userRole.includes('ROLE_ADMIN')) {
            adminLink.style.display = 'inline';
        }
    }

    if (token) {
        const payload = parseJwt(token);
        const now = Math.floor(Date.now() / 1000); // 현재 시간 (초 단위)

        if (!payload || !payload.exp || payload.exp < now) {
            // 토큰 만료된 경우
            localStorage.removeItem('access_token');
            showGuestUI();
        } else {
            showUserUI(payload);
        }
    } else {
        showGuestUI();
    }
</script>
